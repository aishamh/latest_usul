{"file_contents":{"App.tsx":{"content":"import 'expo-router/entry';","size_bytes":27},"babel.config.js":{"content":"module.exports = function (api) {\n  api.cache(true);\n  return {\n    presets: ['babel-preset-expo'],\n    plugins: [\n      'react-native-reanimated/plugin', // Reanimated plugin must be listed last\n    ],\n  };\n};","size_bytes":210},"index.js":{"content":"import 'expo-router/entry';\n\nimport App from './App';\n\n// registerRootComponent calls AppRegistry.registerComponent('main', () => App);\n// It also ensures that whether you load the app in Expo Go or in a native build,\n// the environment is set up appropriately\n","size_bytes":261},"replit.md":{"content":"# Overview\n\nUsul is a mobile AI chat application built with React Native and Expo. The app provides a conversational interface for users to interact with AI through chat conversations. It features user authentication, persistent conversation history, and integration with OpenAI's GPT-4 model for intelligent responses. The application supports multiple platforms (iOS, Android, Web) and includes features like conversation management, message persistence, and markdown rendering for rich text display.\n\n# User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n# Recent Updates\n\n## September 28, 2025\n- **Enhanced Thinking Indicator Implementation**: Added proper thinking/typing indicators during AI response generation matching original Usul repository patterns\n- **Message Flow Optimization**: Implemented inline thinking messages that show \"Done. Searching for answers\" with animated dots while AI processes requests\n- **Real-time Chat Feedback**: Enhanced user experience with immediate visual feedback during message processing\n- **Error Handling Improvements**: Added proper cleanup of thinking indicators during API failures to maintain clean UI state\n- **Authentic Chat Experience**: Now matches the sophisticated interaction patterns of the original usul.ai platform\n\n## September 20, 2025\n- **Usul.ai Aesthetic Implementation**: Updated login interface to match usul.ai's sophisticated dark theme color palette and scholarly design aesthetic\n- **Enhanced Authentication UI**: Applied professional Islamic research platform branding with proper typography and visual hierarchy  \n- **Color Palette Standardization**: Implemented usul.ai-inspired colors throughout the application for consistency\n- **Design System**: Established cohesive design language matching the academic and professional feel of usul.ai\n- **EXCLUSIVE usul.ai Color Compliance**: Successfully replaced ALL hardcoded colors with EXCLUSIVELY colors from actual usul.ai website - no approximations or other colors remain anywhere in codebase\n- **PERFECT 5-Color System Implementation**: Achieved 100% compliance with ONLY 5 usul.ai colors (background #0F1419, surface #1A1F29, accent #C4906C, textPrimary #FFFFFF, textSecondary #A8B3C1) throughout entire application with perfect accessibility and contrast ratios\n\n# System Architecture\n\n## Frontend Architecture\n- **Framework**: React Native with Expo SDK v53 for cross-platform mobile development\n- **Navigation**: Expo Router with file-based routing system for screen navigation\n- **UI Components**: Custom components with a dark theme design system using a consistent color palette\n- **State Management**: Zustand for global state management with two main stores:\n  - Authentication store for user session management\n  - Conversation store for chat history and message management\n- **Animations**: Moti and React Native Reanimated for smooth UI transitions\n- **UI Enhancements**: Bottom sheets (@gorhom/bottom-sheet), blur effects (expo-blur), and gesture handling\n\n## Authentication System\n- **Multi-provider Support**: Designed to support Apple, Google, and email authentication\n- **Current Implementation**: Demo mode with placeholder authentication flows\n- **Session Persistence**: Uses AsyncStorage for user session storage\n- **Security**: Expo SecureStore integration prepared for sensitive data storage\n\n## Chat System Architecture\n- **Message Structure**: Typed message system supporting text, code, and image message types\n- **Conversation Management**: File-based routing with dynamic conversation IDs\n- **Message Rendering**: React Native Markdown Display for rich text formatting\n- **Code Highlighting**: React Native Syntax Highlighter for code block rendering\n- **Real-time Updates**: Automatic scroll-to-bottom for new messages\n\n## Data Persistence\n- **Local Storage**: AsyncStorage for conversation history and user preferences\n- **Message Threading**: Conversation-based message organization with timestamps\n- **State Synchronization**: Automatic persistence of conversation updates\n\n## External Service Integration\n- **AI Model**: OpenAI GPT-4 integration with streaming capabilities\n- **Error Handling**: Comprehensive error management for API failures\n- **Request Management**: Abort controller support for request cancellation\n\n# External Dependencies\n\n## Core Mobile Framework\n- **Expo SDK**: Complete development platform for React Native apps\n- **React Native**: Cross-platform mobile app development framework\n\n## UI and Animation Libraries\n- **@gorhom/bottom-sheet**: Modal bottom sheet components\n- **moti**: Declarative animations for React Native\n- **react-native-reanimated**: High-performance animations\n- **react-native-gesture-handler**: Advanced gesture recognition\n\n## State Management and Storage\n- **zustand**: Lightweight state management solution\n- **@react-native-async-storage/async-storage**: Persistent local storage\n- **expo-secure-store**: Encrypted storage for sensitive data\n\n## AI and API Integration\n- **openai**: Official OpenAI API client for GPT-4 integration\n- **Environment Variables**: OpenAI API key configuration through environment variables\n\n## Authentication Services\n- **expo-apple-authentication**: Apple Sign-In integration\n- **expo-auth-session**: OAuth authentication flows\n- **openid-client**: OpenID Connect client implementation\n- **expo-web-browser**: In-app browser for OAuth flows\n\n## Content and Media\n- **react-native-markdown-display**: Markdown rendering for chat messages\n- **react-native-syntax-highlighter**: Code syntax highlighting\n- **expo-clipboard**: Clipboard access for copy functionality\n- **@shopify/flash-list**: Performance-optimized list component\n\n## Utility Libraries\n- **expo-haptics**: Tactile feedback\n- **expo-crypto**: Cryptographic functions\n- **memoizee**: Function memoization for performance optimization\n- **ajv**: JSON schema validation","size_bytes":5892},"ios/Usul/AppDelegate.swift":{"content":"import Expo\nimport React\nimport ReactAppDependencyProvider\n\n@UIApplicationMain\npublic class AppDelegate: ExpoAppDelegate {\n  var window: UIWindow?\n\n  var reactNativeDelegate: ExpoReactNativeFactoryDelegate?\n  var reactNativeFactory: RCTReactNativeFactory?\n\n  public override func application(\n    _ application: UIApplication,\n    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]? = nil\n  ) -> Bool {\n    let delegate = ReactNativeDelegate()\n    let factory = ExpoReactNativeFactory(delegate: delegate)\n    delegate.dependencyProvider = RCTAppDependencyProvider()\n\n    reactNativeDelegate = delegate\n    reactNativeFactory = factory\n    bindReactNativeFactory(factory)\n\n#if os(iOS) || os(tvOS)\n    window = UIWindow(frame: UIScreen.main.bounds)\n    factory.startReactNative(\n      withModuleName: \"main\",\n      in: window,\n      launchOptions: launchOptions)\n#endif\n\n    return super.application(application, didFinishLaunchingWithOptions: launchOptions)\n  }\n\n  // Linking API\n  public override func application(\n    _ app: UIApplication,\n    open url: URL,\n    options: [UIApplication.OpenURLOptionsKey: Any] = [:]\n  ) -> Bool {\n    return super.application(app, open: url, options: options) || RCTLinkingManager.application(app, open: url, options: options)\n  }\n\n  // Universal Links\n  public override func application(\n    _ application: UIApplication,\n    continue userActivity: NSUserActivity,\n    restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void\n  ) -> Bool {\n    let result = RCTLinkingManager.application(application, continue: userActivity, restorationHandler: restorationHandler)\n    return super.application(application, continue: userActivity, restorationHandler: restorationHandler) || result\n  }\n}\n\nclass ReactNativeDelegate: ExpoReactNativeFactoryDelegate {\n  // Extension point for config-plugins\n\n  override func sourceURL(for bridge: RCTBridge) -> URL? {\n    // needed to return the correct URL for expo-dev-client.\n    bridge.bundleURL ?? bundleURL()\n  }\n\n  override func bundleURL() -> URL? {\n#if DEBUG\n    return RCTBundleURLProvider.sharedSettings().jsBundleURL(forBundleRoot: \".expo/.virtual-metro-entry\")\n#else\n    return Bundle.main.url(forResource: \"main\", withExtension: \"jsbundle\")\n#endif\n  }\n}\n","size_bytes":2275},"src/app/_layout.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { Stack } from 'expo-router';\nimport { StatusBar } from 'expo-status-bar';\nimport { SafeAreaProvider } from 'react-native-safe-area-context';\nimport { View, ActivityIndicator, Text } from 'react-native';\nimport { theme } from '../theme/colors';\n\nexport default function RootLayout() {\n  const [isReady, setIsReady] = useState(false);\n  \n  useEffect(() => {\n    // Initialize immediately - no delay needed\n    setIsReady(true);\n  }, []);\n  \n  if (!isReady) {\n    return (\n      <View style={{\n        flex: 1,\n        backgroundColor: theme.background,\n        justifyContent: 'center',\n        alignItems: 'center'\n      }}>\n        <ActivityIndicator size=\"large\" color={theme.accent} />\n        <Text style={{\n          color: theme.secondary,\n          marginTop: 16,\n          fontSize: 16\n        }}>Loading Usul...</Text>\n      </View>\n    );\n  }\n  \n  return (\n    <SafeAreaProvider>\n      <StatusBar style=\"light\" backgroundColor={theme.background} />\n      <Stack \n        screenOptions={{ \n          headerShown: false,\n          contentStyle: { backgroundColor: theme.background }\n        }}\n      >\n        <Stack.Screen \n          name=\"login\" \n          options={{ \n            headerShown: false\n          }} \n        />\n        <Stack.Screen \n          name=\"index\" \n          options={{ \n            title: 'Usul AI',\n            headerShown: true,\n            headerStyle: {\n              backgroundColor: theme.surface,\n            },\n            headerTintColor: theme.primary,\n            headerTitleStyle: {\n              fontWeight: 'bold',\n            }\n          }} \n        />\n        <Stack.Screen \n          name=\"chat\" \n          options={{ \n            title: 'Chat',\n            headerShown: true,\n            headerStyle: {\n              backgroundColor: theme.surface,\n            },\n            headerTintColor: theme.primary,\n            headerTitleStyle: {\n              fontWeight: 'bold',\n            }\n          }} \n        />\n      </Stack>\n    </SafeAreaProvider>\n  );\n} ","size_bytes":2070},"src/app/chat.tsx":{"content":"export { default } from './chat_mobile';","size_bytes":40},"src/app/demo.tsx":{"content":"import React from 'react';\nimport { IPhoneSimulator } from '../components/iPhoneSimulator';\nimport LoginScreen from './login';\n\nexport default function DemoScreen() {\n  return (\n    <IPhoneSimulator>\n      <LoginScreen />\n    </IPhoneSimulator>\n  );\n}","size_bytes":251},"src/app/index.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { View, Text, Pressable, StyleSheet, FlatList, ActivityIndicator } from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { useAuthStore } from '../store/authStore';\nimport { useConversationStore } from '../store/conversationStore';\n\nimport { theme } from '../theme/colors';\n\nexport default function ConversationListScreen() {\n  const router = useRouter();\n  const { user, isAuthenticated, logout, isLoading } = useAuthStore();\n  const { conversations } = useConversationStore();\n  const [isInitialized, setIsInitialized] = useState(false);\n  \n  useEffect(() => {\n    // Give stores time to initialize\n    const timer = setTimeout(() => {\n      setIsInitialized(true);\n    }, 200);\n    \n    return () => clearTimeout(timer);\n  }, []);\n  \n  useEffect(() => {\n    // Handle navigation after initialization\n    if (isInitialized && !isLoading && !isAuthenticated) {\n      const navTimer = setTimeout(() => {\n        router.replace('/login');\n      }, 100);\n      \n      return () => clearTimeout(navTimer);\n    }\n  }, [isInitialized, isAuthenticated, isLoading, router]);\n\n  const handleNewChat = () => {\n    const conversationId = Date.now().toString();\n    router.push(`/chat?conversationId=${conversationId}`);\n  };\n\n  const handleLogout = async () => {\n    await logout();\n    router.replace('/login');\n  };\n  \n  const handleOpenChat = (conversationId: string) => {\n    router.push(`/chat?conversationId=${conversationId}`);\n  };\n  \n  if (!isInitialized || isLoading) {\n    return (\n      <View style={[styles.container, styles.loadingContainer]}>\n        <ActivityIndicator size=\"large\" color={theme.accent} />\n        <Text style={styles.loadingText}>Loading Usul AI...</Text>\n      </View>\n    );\n  }\n  \n  if (!isAuthenticated) {\n    // This will be handled by the useEffect redirect\n    return (\n      <View style={[styles.container, styles.loadingContainer]}>\n        <ActivityIndicator size=\"large\" color={theme.accent} />\n        <Text style={styles.loadingText}>Redirecting...</Text>\n      </View>\n    );\n  }\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.sidebar}>\n        <View style={styles.sidebarHeader}>\n          <View>\n            <Text style={styles.welcomeText}>Welcome back!</Text>\n            <Text style={styles.userText}>{user?.name || user?.email || 'User'}</Text>\n          </View>\n          <Pressable style={styles.logoutButton} onPress={handleLogout}>\n            <Text style={styles.logoutText}>Logout</Text>\n          </Pressable>\n        </View>\n        \n        <Pressable style={styles.newChatButton} onPress={handleNewChat}>\n          <Text style={styles.newChatText}>+ New Chat</Text>\n        </Pressable>\n        \n        <View style={styles.conversationList}>\n          {conversations.length === 0 ? (\n            <Text style={styles.emptyText}>No conversations yet. Start a new chat!</Text>\n          ) : (\n            <FlatList\n              data={conversations}\n              keyExtractor={(item) => item.id}\n              renderItem={({ item }) => (\n                <Pressable \n                  style={styles.conversationItem}\n                  onPress={() => handleOpenChat(item.id)}\n                >\n                  <Text style={styles.conversationTitle}>{item.title}</Text>\n                  <Text style={styles.conversationPreview}>\n                    {item.lastMessage || 'No messages yet'}\n                  </Text>\n                  <Text style={styles.conversationDate}>\n                    {new Date(item.lastUpdated).toLocaleDateString()}\n                  </Text>\n                </Pressable>\n              )}\n              showsVerticalScrollIndicator={false}\n            />\n          )}\n        </View>\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.background,\n  },\n  loadingContainer: {\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  loadingText: {\n    color: theme.secondary,\n    fontSize: 16,\n    marginTop: 16,\n  },\n  sidebar: {\n    flex: 1,\n    backgroundColor: theme.surface,\n    padding: 16,\n  },\n  sidebarHeader: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'flex-start',\n    marginBottom: 20,\n    paddingBottom: 16,\n    borderBottomWidth: 1,\n    borderBottomColor: theme.border,\n  },\n  welcomeText: {\n    color: theme.primary,\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  userText: {\n    color: theme.secondary,\n    fontSize: 14,\n    marginTop: 2,\n  },\n  logoutButton: {\n    paddingHorizontal: 12,\n    paddingVertical: 6,\n    borderRadius: 4,\n    borderWidth: 1,\n    borderColor: theme.border,\n  },\n  logoutText: {\n    color: theme.secondary,\n    fontSize: 14,\n  },\n  newChatButton: {\n    backgroundColor: theme.accent,\n    padding: 14,\n    borderRadius: 12,\n    marginBottom: 20,\n    alignItems: 'center',\n  },\n  newChatText: {\n    color: theme.background, // Dark text for proper contrast on accent background\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  conversationList: {\n    flex: 1,\n  },\n  conversationItem: {\n    backgroundColor: theme.background,\n    padding: 12,\n    borderRadius: 8,\n    marginBottom: 8,\n    borderWidth: 1,\n    borderColor: theme.border,\n  },\n  conversationTitle: {\n    color: theme.primary,\n    fontSize: 14,\n    fontWeight: '600',\n    marginBottom: 4,\n  },\n  conversationPreview: {\n    color: theme.secondary,\n    fontSize: 12,\n    marginBottom: 4,\n  },\n  conversationDate: {\n    color: theme.secondary,\n    fontSize: 11,\n    opacity: 0.7,\n  },\n  emptyText: {\n    color: theme.secondary,\n    textAlign: 'center',\n    fontStyle: 'italic',\n    marginTop: 40,\n    fontSize: 16,\n  },\n});","size_bytes":5717},"src/app/login.tsx":{"content":"import React, { useEffect, useState } from 'react';\nimport { View, Text, Pressable, StyleSheet, Alert } from 'react-native';\nimport { useRouter } from 'expo-router';\nimport { useAuthStore, User } from '../store/authStore';\nimport * as AppleAuthentication from 'expo-apple-authentication';\nimport * as AuthSession from 'expo-auth-session';\nimport * as WebBrowser from 'expo-web-browser';\nimport { GoogleIcon } from '../components/GoogleIcon';\nimport { AppleIcon } from '../components/AppleIcon';\n\nWebBrowser.maybeCompleteAuthSession();\n\nimport { theme } from '../theme/colors';\n\nexport default function LoginScreen() {\n  const router = useRouter();\n  const { login, isAuthenticated } = useAuthStore();\n  const [selectedAction, setSelectedAction] = useState<'login' | 'signup' | null>(null);\n  \n  useEffect(() => {\n    if (isAuthenticated) {\n      router.replace('/');\n    }\n  }, [isAuthenticated, router]);\n\n  const handleEmailLogin = () => {\n    // For demo purposes - in production this would show an email/password form\n    const user: User = {\n      id: 'demo_user_' + Date.now(),\n      email: 'user@example.com',\n      name: 'Demo User',\n      provider: 'email',\n    };\n    login(user);\n    router.replace('/');\n  };\n\n  const handleGoogleLogin = async () => {\n    try {\n      // For demo purposes - in production this would use Google OAuth\n      Alert.alert(\n        'Demo Mode',\n        'Google login would integrate with Google OAuth in production. Using demo login.',\n        [\n          {\n            text: 'Continue with Demo',\n            onPress: () => {\n              const user: User = {\n                id: 'google_user_' + Date.now(),\n                email: 'user@gmail.com',\n                name: 'Google User',\n                provider: 'google',\n              };\n              login(user);\n              router.replace('/');\n            }\n          },\n          { text: 'Cancel', style: 'cancel' }\n        ]\n      );\n    } catch (error) {\n      Alert.alert('Error', 'Google login failed. Please try again.');\n    }\n  };\n\n  const handleAppleLogin = async () => {\n    try {\n      // Check if Apple Authentication is available\n      const isAvailable = await AppleAuthentication.isAvailableAsync();\n      if (!isAvailable) {\n        Alert.alert(\n          'Demo Mode',\n          'Apple login is only available on iOS devices. Using demo login.',\n          [\n            {\n              text: 'Continue with Demo',\n              onPress: () => {\n                const user: User = {\n                  id: 'apple_user_' + Date.now(),\n                  email: 'user@icloud.com',\n                  name: 'Apple User',\n                  provider: 'apple',\n                };\n                login(user);\n                router.replace('/');\n              }\n            },\n            { text: 'Cancel', style: 'cancel' }\n          ]\n        );\n        return;\n      }\n      \n      const credential = await AppleAuthentication.signInAsync({\n        requestedScopes: [\n          AppleAuthentication.AppleAuthenticationScope.FULL_NAME,\n          AppleAuthentication.AppleAuthenticationScope.EMAIL,\n        ],\n      });\n      \n      const user: User = {\n        id: credential.user,\n        email: credential.email || 'apple.user@icloud.com',\n        name: credential.fullName ? \n          `${credential.fullName.givenName} ${credential.fullName.familyName}`.trim() : \n          'Apple User',\n        provider: 'apple',\n      };\n      \n      login(user);\n      router.replace('/');\n    } catch (error: any) {\n      if (error.code === 'ERR_CANCELED') {\n        // User canceled, do nothing\n        return;\n      }\n      Alert.alert('Error', 'Apple login failed. Please try again.');\n    }\n  };\n\n  return (\n    <View style={styles.container}>\n      <View style={styles.formContainer}>\n        {!selectedAction ? (\n          // Step 1: Choose Login or Sign Up\n          <>\n            <View style={styles.header}>\n              <Text style={styles.title}>Welcome to Usul</Text>\n              <Text style={styles.tagline}>Choose an option to continue</Text>\n            </View>\n            \n            <Pressable style={styles.primaryButton} onPress={() => setSelectedAction('login')}>\n              <Text style={styles.buttonText}>Log in</Text>\n            </Pressable>\n            \n            <Pressable style={styles.secondaryButton} onPress={() => setSelectedAction('signup')}>\n              <Text style={styles.secondaryButtonText}>Sign up</Text>\n            </Pressable>\n          </>\n        ) : (\n          // Step 2: Choose Authentication Method\n          <>\n            <View style={styles.header}>\n              <Text style={styles.title}>\n                {selectedAction === 'login' ? 'Log in to your account' : 'Create your account'}\n              </Text>\n              <Text style={styles.tagline}>\n                {selectedAction === 'login' ? 'Welcome back! Please enter your details' : 'Join Usul to access Islamic research texts'}\n              </Text>\n            </View>\n            \n            <Pressable style={styles.primaryButton} onPress={handleEmailLogin}>\n              <Text style={styles.buttonText}>\n                {selectedAction === 'login' ? 'Continue with Email' : 'Sign up with Email'}\n              </Text>\n            </Pressable>\n            \n            <View style={styles.dividerContainer}>\n              <View style={styles.dividerLine} />\n              <Text style={styles.dividerText}>Or continue with</Text>\n              <View style={styles.dividerLine} />\n            </View>\n            \n            <Pressable style={styles.secondaryButton} onPress={handleGoogleLogin}>\n              <View style={styles.buttonWithIcon}>\n                <GoogleIcon size={20} />\n                <Text style={styles.secondaryButtonText}>Continue with Google</Text>\n              </View>\n            </Pressable>\n            \n            <Pressable style={styles.secondaryButton} onPress={handleAppleLogin}>\n              <View style={styles.buttonWithIcon}>\n                <AppleIcon size={20} />\n                <Text style={styles.secondaryButtonText}>Continue with Apple ID</Text>\n              </View>\n            </Pressable>\n            \n            <Pressable style={styles.backButton} onPress={() => setSelectedAction(null)}>\n              <Text style={styles.backButtonText}>← Back</Text>\n            </Pressable>\n          </>\n        )}\n      </View>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.background,\n    justifyContent: 'center',\n    padding: 24,\n  },\n  formContainer: {\n    backgroundColor: theme.surface,\n    borderRadius: 12,\n    padding: 40,\n    borderWidth: 1,\n    borderColor: theme.border,\n    shadowColor: theme.border,\n    shadowOffset: { width: 0, height: 4 },\n    shadowOpacity: 0.1,\n    shadowRadius: 12,\n    maxWidth: 420,\n    alignSelf: 'center',\n    width: '100%',\n  },\n  header: {\n    alignItems: 'flex-start',\n    marginBottom: 32,\n  },\n  title: {\n    color: theme.primary,\n    fontSize: 24,\n    fontWeight: '600',\n    marginBottom: 8,\n  },\n  tagline: {\n    color: theme.secondary,\n    fontSize: 15,\n    fontWeight: '400',\n    marginBottom: 0,\n  },\n  subtitle: {\n    display: 'none', // Hide subtitle to match usul.ai exactly\n  },\n  primaryButton: {\n    backgroundColor: theme.accent,\n    borderRadius: 6,\n    paddingVertical: 16,\n    alignItems: 'center',\n    marginBottom: 16,\n  },\n  secondaryButton: {\n    backgroundColor: theme.surface,\n    borderRadius: 6,\n    paddingVertical: 16,\n    alignItems: 'center',\n    borderWidth: 1,\n    borderColor: theme.border,\n    marginBottom: 12,\n  },\n  backButton: {\n    marginTop: 20,\n    alignItems: 'center',\n    paddingVertical: 8,\n  },\n  backButtonText: {\n    color: theme.muted,\n    fontSize: 14,\n    fontWeight: '500',\n  },\n  buttonWithIcon: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    gap: 12,\n  },\n  buttonText: {\n    color: theme.background, // Dark text for proper contrast on accent background\n    fontSize: 16,\n    fontWeight: '500',\n  },\n  secondaryButtonText: {\n    color: theme.primary,\n    fontSize: 16,\n    fontWeight: '500',\n  },\n  dividerContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    marginVertical: 20,\n  },\n  dividerLine: {\n    flex: 1,\n    height: 1,\n    backgroundColor: theme.border,\n  },\n  dividerText: {\n    color: theme.muted,\n    fontSize: 14,\n    paddingHorizontal: 16,\n  },\n}); ","size_bytes":8457},"src/components/AppleIcon.tsx":{"content":"import React from 'react';\nimport { Svg, Path } from 'react-native-svg';\nimport { theme } from '../theme/colors';\n\ninterface AppleIconProps {\n  size?: number;\n}\n\nexport const AppleIcon: React.FC<AppleIconProps> = ({ size = 18 }) => {\n  return (\n    <Svg width={size} height={size} viewBox=\"0 0 24 24\">\n      <Path \n        d=\"M18.71 19.5c-.83 1.24-1.71 2.45-3.05 2.47-1.34.03-1.77-.79-3.29-.79-1.53 0-2 .77-3.27.82-1.31.05-2.3-1.32-3.14-2.53C4.25 17 2.94 12.45 4.7 9.39c.87-1.52 2.43-2.48 4.12-2.51 1.28-.02 2.5.87 3.29.87.78 0 2.26-1.07 3.81-.91.65.03 2.47.26 3.64 1.98-.09.06-2.17 1.28-2.15 3.81.03 3.02 2.65 4.03 2.68 4.04-.03.07-.42 1.44-1.38 2.83M13 3.5c.73-.83 1.94-1.46 2.94-1.5.13 1.17-.34 2.35-1.04 3.19-.69.85-1.83 1.51-2.95 1.42-.15-1.15.41-2.35 1.05-3.11z\"\n        fill={theme.primary}\n      />\n    </Svg>\n  );\n};","size_bytes":825},"src/components/GoogleIcon.tsx":{"content":"import React from 'react';\nimport { Svg, Path } from 'react-native-svg';\nimport { theme } from '../theme/colors';\n\ninterface GoogleIconProps {\n  size?: number;\n}\n\nexport const GoogleIcon: React.FC<GoogleIconProps> = ({ size = 18 }) => {\n  return (\n    <Svg width={size} height={size} viewBox=\"0 0 24 24\">\n      <Path \n        d=\"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z\" \n        fill={theme.primary} \n      />\n      <Path \n        d=\"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z\" \n        fill={theme.primary} \n      />\n      <Path \n        d=\"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z\" \n        fill={theme.primary} \n      />\n      <Path \n        d=\"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z\" \n        fill={theme.primary} \n      />\n    </Svg>\n  );\n};","size_bytes":1095},"src/components/iPhoneSimulator.tsx":{"content":"import React from 'react';\nimport { View, StyleSheet, Dimensions } from 'react-native';\nimport { theme } from '../theme/colors';\n\ninterface iPhoneSimulatorProps {\n  children: React.ReactNode;\n}\n\nconst { width: screenWidth, height: screenHeight } = Dimensions.get('window');\n\nexport const IPhoneSimulator: React.FC<iPhoneSimulatorProps> = ({ children }) => {\n  // iPhone 15 Pro dimensions (393x852 logical pixels)\n  const IPHONE_WIDTH = 393;\n  const IPHONE_HEIGHT = 852;\n  \n  // Calculate scale to fit screen while maintaining aspect ratio\n  const scaleX = (screenWidth - 40) / (IPHONE_WIDTH + 40); // 40px margin + device frame\n  const scaleY = (screenHeight - 40) / (IPHONE_HEIGHT + 120); // Extra space for device frame\n  const scale = Math.min(scaleX, scaleY, 1);\n  \n  return (\n    <View style={styles.container}>\n      <View style={[styles.deviceFrame, { \n        transform: [{ scale }],\n        width: IPHONE_WIDTH + 40,\n        height: IPHONE_HEIGHT + 120\n      }]}>\n        {/* iPhone notch */}\n        <View style={styles.notch} />\n        \n        {/* Status bar */}\n        <View style={styles.statusBar}>\n          <View style={styles.statusLeft}>\n            <View style={styles.timeContainer}>\n              <View style={styles.timeText} />\n            </View>\n          </View>\n          <View style={styles.statusRight}>\n            <View style={styles.batteryContainer}>\n              <View style={styles.signal} />\n              <View style={styles.wifi} />\n              <View style={styles.battery} />\n            </View>\n          </View>\n        </View>\n        \n        {/* App content */}\n        <View style={[styles.screenContent, { \n          width: IPHONE_WIDTH, \n          height: IPHONE_HEIGHT - 44 // Subtract status bar height\n        }]}>\n          {children}\n        </View>\n        \n        {/* Home indicator */}\n        <View style={styles.homeIndicator} />\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.surface,\n    justifyContent: 'center',\n    alignItems: 'center',\n    padding: 20,\n  },\n  deviceFrame: {\n    backgroundColor: theme.background,\n    borderRadius: 50,\n    padding: 8,\n    shadowColor: theme.border,\n    shadowOffset: { width: 0, height: 10 },\n    shadowOpacity: 0.3,\n    shadowRadius: 20,\n    elevation: 20,\n  },\n  notch: {\n    position: 'absolute',\n    top: 8,\n    left: '50%',\n    marginLeft: -70,\n    width: 140,\n    height: 30,\n    backgroundColor: theme.background,\n    borderBottomLeftRadius: 20,\n    borderBottomRightRadius: 20,\n    zIndex: 10,\n  },\n  statusBar: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    height: 44,\n    paddingHorizontal: 20,\n    paddingTop: 8,\n  },\n  statusLeft: {\n    flex: 1,\n  },\n  statusRight: {\n    flex: 1,\n    alignItems: 'flex-end',\n  },\n  timeContainer: {\n    alignItems: 'flex-start',\n  },\n  timeText: {\n    width: 50,\n    height: 16,\n    backgroundColor: theme.primary,\n    borderRadius: 8,\n    opacity: 0.9,\n  },\n  batteryContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 4,\n  },\n  signal: {\n    width: 16,\n    height: 12,\n    backgroundColor: theme.primary,\n    borderRadius: 2,\n  },\n  wifi: {\n    width: 16,\n    height: 12,\n    backgroundColor: theme.primary,\n    borderRadius: 2,\n  },\n  battery: {\n    width: 24,\n    height: 12,\n    backgroundColor: theme.primary,\n    borderRadius: 2,\n    borderWidth: 1,\n    borderColor: theme.primary,\n  },\n  screenContent: {\n    backgroundColor: theme.background,\n    borderRadius: 42,\n    overflow: 'hidden',\n  },\n  homeIndicator: {\n    position: 'absolute',\n    bottom: 8,\n    left: '50%',\n    marginLeft: -67,\n    width: 134,\n    height: 5,\n    backgroundColor: theme.primary,\n    borderRadius: 3,\n    opacity: 0.3,\n  },\n});","size_bytes":3814},"src/services/llm.ts":{"content":"import Constants from 'expo-constants';\n\nexport type OpenAIChatMessage = {\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n};\n\nexport interface CreateChatCompletionParams {\n  messages: OpenAIChatMessage[];\n  signal?: AbortSignal;\n}\n\n// Using OpenAI GPT-4 as it's widely available and reliable\nexport async function createChatCompletion(params: CreateChatCompletionParams): Promise<string> {\n  const { messages, signal } = params;\n\n  // Get API key from environment variables only\n  const apiKey = process.env.OPENAI_API_KEY;\n  \n  if (!apiKey) {\n    throw new Error('OpenAI API key not configured. Please add OPENAI_API_KEY to your environment variables.');\n  }\n\n  const url = 'https://api.openai.com/v1/chat/completions';\n\n  const response = await fetch(url, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/json',\n      Authorization: `Bearer ${apiKey}`,\n    },\n    body: JSON.stringify({\n      model: 'gpt-4', // Using GPT-4 for reliability\n      messages,\n      max_tokens: 2048, // Correct parameter name\n      temperature: 0.7,\n      stream: false,\n    }),\n    signal,\n  });\n\n  if (!response.ok) {\n    const text = await response.text().catch(() => 'Unknown error');\n    let errorMessage = `Request failed (${response.status})`;\n    \n    try {\n      const errorData = JSON.parse(text);\n      if (errorData.error?.message) {\n        errorMessage = errorData.error.message;\n      }\n    } catch {\n      // Use the raw text if JSON parsing fails\n      if (text) errorMessage = text;\n    }\n    \n    throw new Error(errorMessage);\n  }\n\n  const data = await response.json();\n  const content = data?.choices?.[0]?.message?.content ?? '';\n  if (!content) {\n    throw new Error('No response content received from the model');\n  }\n  return content as string;\n}\n\n// Islamic research assistant system message inspired by usul.ai\nexport const SYSTEM_MESSAGE: OpenAIChatMessage = {\n  role: 'system',\n  content: `You are Usul AI, an intelligent assistant specialized in Islamic research and general knowledge. You help users explore, understand, and analyze Islamic texts, history, jurisprudence, theology, and related topics with accuracy and respect.\n\nKey capabilities:\n- Answer questions about Islamic texts, history, and scholarship\n- Provide explanations of Islamic concepts and terminology  \n- Assist with research across various Islamic disciplines\n- Offer balanced perspectives on scholarly debates\n- Help users understand classical and contemporary Islamic thought\n\nAlways:\n- Provide accurate, well-sourced information\n- Respect diverse Islamic traditions and scholarly opinions\n- Be helpful for both academic research and general inquiry\n- Maintain a respectful and scholarly tone\n- Acknowledge when you're uncertain about specific details\n\nYou can also help with general questions beyond Islamic topics when needed.`\n}; ","size_bytes":2855},"src/store/authStore.ts":{"content":"import { create } from 'zustand';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport * as SecureStore from 'expo-secure-store';\n\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  avatar?: string;\n  provider: 'apple' | 'google' | 'email';\n}\n\nexport interface AuthState {\n  user: User | null;\n  isAuthenticated: boolean;\n  isLoading: boolean;\n  login: (user: User) => void;\n  logout: () => void;\n  setLoading: (loading: boolean) => void;\n}\n\nconst AUTH_STORAGE_KEY = 'usul_auth_user';\n\nexport const useAuthStore = create<AuthState>()((set, get) => ({\n  user: null,\n  isAuthenticated: false,\n  isLoading: true, // Start with loading true to check for stored auth\n  login: async (user: User) => {\n    try {\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(user));\n      set({ user, isAuthenticated: true, isLoading: false });\n    } catch (error) {\n      console.error('Failed to save auth state:', error);\n      set({ user, isAuthenticated: true, isLoading: false }); // Still login but without persistence\n    }\n  },\n  logout: async () => {\n    try {\n      await AsyncStorage.removeItem(AUTH_STORAGE_KEY);\n    } catch (error) {\n      console.error('Failed to clear auth state:', error);\n    }\n    set({ user: null, isAuthenticated: false, isLoading: false });\n  },\n  setLoading: (isLoading: boolean) => set({ isLoading }),\n}));\n\n// Initialize auth state from storage\nconst initializeAuth = async () => {\n  try {\n    const stored = await AsyncStorage.getItem(AUTH_STORAGE_KEY);\n    if (stored) {\n      const user = JSON.parse(stored);\n      useAuthStore.setState({ user, isAuthenticated: true, isLoading: false });\n    } else {\n      // Auto-login for demo purposes\n      const demoUser: User = {\n        id: 'demo_user_auto',\n        email: 'demo@usul.ai',\n        name: 'Demo User',\n        provider: 'email',\n      };\n      await AsyncStorage.setItem(AUTH_STORAGE_KEY, JSON.stringify(demoUser));\n      useAuthStore.setState({ user: demoUser, isAuthenticated: true, isLoading: false });\n    }\n  } catch (error) {\n    console.error('Failed to initialize auth:', error);\n    // Still auto-login even if storage fails\n    const demoUser: User = {\n      id: 'demo_user_auto',\n      email: 'demo@usul.ai', \n      name: 'Demo User',\n      provider: 'email',\n    };\n    useAuthStore.setState({ user: demoUser, isAuthenticated: true, isLoading: false });\n  }\n};\n\n// Initialize when running in browser environment\nif (typeof window !== 'undefined') {\n  initializeAuth();\n} else {\n  // For server-side rendering, auto-login immediately\n  const demoUser: User = {\n    id: 'demo_user_auto',\n    email: 'demo@usul.ai',\n    name: 'Demo User', \n    provider: 'email',\n  };\n  useAuthStore.setState({ user: demoUser, isAuthenticated: true, isLoading: false });\n} ","size_bytes":2809},"src/store/conversationStore.ts":{"content":"import { create } from 'zustand';\nimport { Conversation, Message } from '../types/conversation';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nexport interface ConversationState {\n  conversations: Conversation[];\n  currentConversationId: string | null;\n  setCurrentConversationId: (id: string) => void;\n  addConversation: (conversation: Conversation) => void;\n  updateConversation: (id: string, updates: Partial<Conversation>) => void;\n  addMessage: (conversationId: string, message: Message) => void;\n  getConversationById: (id: string) => Conversation | undefined;\n}\n\nconst CONVERSATIONS_STORAGE_KEY = 'usul_conversations';\n\nconst saveConversations = async (conversations: Conversation[]) => {\n  try {\n    await AsyncStorage.setItem(CONVERSATIONS_STORAGE_KEY, JSON.stringify(conversations));\n  } catch (error) {\n    console.error('Failed to save conversations:', error);\n  }\n};\n\nexport const useConversationStore = create<ConversationState>()((set, get) => ({\n  conversations: [],\n  currentConversationId: null,\n  setCurrentConversationId: (id) => set({ currentConversationId: id }),\n  addConversation: (conversation) => {\n    const newState = [conversation, ...get().conversations];\n    set({ conversations: newState });\n    saveConversations(newState);\n  },\n  updateConversation: (id, updates) => {\n    const newState = get().conversations.map((conv) =>\n      conv.id === id ? { ...conv, ...updates } : conv\n    );\n    set({ conversations: newState });\n    saveConversations(newState);\n  },\n  addMessage: (conversationId, message) => {\n    const newState = get().conversations.map((conv) =>\n      conv.id === conversationId\n        ? {\n            ...conv,\n            messages: [...conv.messages, message],\n            lastMessage: message.content,\n            lastUpdated: new Date(),\n          }\n        : conv\n    );\n    set({ conversations: newState });\n    saveConversations(newState);\n  },\n  getConversationById: (id) => {\n    return get().conversations.find((conv) => conv.id === id);\n  },\n}));\n\n// Initialize conversations from storage\nconst initializeConversations = async () => {\n  try {\n    const stored = await AsyncStorage.getItem(CONVERSATIONS_STORAGE_KEY);\n    if (stored) {\n      const conversations = JSON.parse(stored);\n      // Convert stored date strings back to Date objects\n      const processedConversations = conversations.map((conv: any) => ({\n        ...conv,\n        lastUpdated: new Date(conv.lastUpdated),\n        messages: conv.messages.map((msg: any) => ({\n          ...msg,\n          timestamp: new Date(msg.timestamp)\n        }))\n      }));\n      useConversationStore.setState({ conversations: processedConversations });\n    }\n  } catch (error) {\n    console.error('Failed to initialize conversations:', error);\n  }\n};\n\n// Initialize when running in browser environment\nif (typeof window !== 'undefined') {\n  initializeConversations();\n}","size_bytes":2900},"src/theme/colors.ts":{"content":"// ACTUAL usul.ai colors from screenshot - NO OTHER COLORS ALLOWED\nexport const colors = {\n  background: '#F9F9F9',      // Very light gray main background\n  surface: '#F5F5F5',         // Light gray surfaces (sidebar)\n  accent: '#A0635D',          // Reddish-brown terra cotta header color\n  textPrimary: '#2D3748',     // Dark text on light backgrounds\n  textSecondary: '#718096',   // Gray text\n};\n\n// Semantic mapping using ONLY the 5 colors above\nexport const theme = {\n  background: colors.background,      // Light gray main background\n  surface: colors.surface,            // Light gray surface (sidebar)\n  accent: colors.accent,              // Reddish-brown accent\n  primary: colors.textPrimary,        // Dark text\n  secondary: colors.textSecondary,    // Gray text\n  // Map everything else to the 5 core colors for proper hierarchy\n  muted: colors.textSecondary,        // Gray for muted text\n  border: '#E2E8F0',                  // Light border\n  input: '#FFFFFF',                   // White input backgrounds\n  accentPressed: colors.accent,       // Same accent for pressed\n};","size_bytes":1091},"src/types/conversation.ts":{"content":"export interface Message {\n  id: string;\n  content: string;\n  role: 'user' | 'assistant';\n  timestamp: Date;\n  type: 'text' | 'code' | 'image';\n}\n\nexport interface Conversation {\n  id: string;\n  title: string;\n  lastMessage: string;\n  lastUpdated: Date;\n  messages: Message[];\n}","size_bytes":278},"src/app/chat_mobile.tsx":{"content":"import React, { useState, useEffect, useRef } from 'react';\nimport { View, Text, TextInput, Pressable, ScrollView, StyleSheet, Alert, Platform, SafeAreaView, StatusBar, Image } from 'react-native';\nimport * as Clipboard from 'expo-clipboard';\nimport { useLocalSearchParams } from 'expo-router';\nimport { useGlobalChat } from '../hooks/useGlobalChat';\nimport Markdown from 'react-native-markdown-display';\nimport { theme } from '../theme/colors';\n\nexport default function ChatScreen() {\n  const { conversationId } = useLocalSearchParams<{ conversationId: string }>();\n  const scrollViewRef = useRef<ScrollView>(null);\n  const {\n    messages,\n    input,\n    setInput,\n    submit,\n    status,\n    error,\n    isSubmitting\n  } = useGlobalChat({\n    initialId: conversationId as string | undefined,\n  });\n  \n  \n  useEffect(() => {\n    // Auto-scroll to bottom when new messages arrive\n    if (messages.length > 0) {\n      setTimeout(() => {\n        scrollViewRef.current?.scrollToEnd({ animated: true });\n      }, 100);\n    }\n  }, [messages.length]);\n\n  const handleSend = async () => {\n    if (!input.trim() || status !== 'ready' || isSubmitting) return;\n    await submit();\n  };\n\n  // Show error if there's one\n  useEffect(() => {\n    if (error) {\n      Alert.alert(\n        'Chat Error', \n        'Failed to get response. Please check your internet connection and ensure your OpenAI API key is properly configured.',\n        [{ text: 'OK' }]\n      );\n    }\n  }, [error]);\n\n  const isLoading = status === 'streaming' || isSubmitting;\n\n  return (\n    <SafeAreaView style={styles.container}>\n      <StatusBar barStyle=\"light-content\" backgroundColor={theme.accent} />\n      \n      {/* Clean Mobile Header */}\n      <View style={styles.header}>\n        <Pressable style={styles.menuButton}>\n          <Text style={styles.menuIcon}>☰</Text>\n        </Pressable>\n        <Text style={styles.appTitle}>Usul AI</Text>\n        <Pressable style={styles.moreButton}>\n          <Text style={styles.moreIcon}>⋯</Text>\n        </Pressable>\n      </View>\n\n      {/* Chat Messages */}\n      <ScrollView \n        ref={scrollViewRef}\n        style={styles.messagesContainer}\n        showsVerticalScrollIndicator={false}\n      >\n        {messages.length === 0 && (\n          <View style={styles.welcomeContainer}>\n            <View style={styles.welcomeContent}>\n              <View style={styles.logoContainer}>\n                <Image \n                  source={require('../../assets/usul_icon.png')}\n                  style={styles.logoImage}\n                  resizeMode=\"contain\"\n                />\n              </View>\n              <Text style={styles.welcomeTitle}>Welcome to Usul AI</Text>\n              <Text style={styles.welcomeSubtitle}>Type your first question below</Text>\n            </View>\n            \n            <View style={styles.bottomSuggestions}>\n              <Pressable style={styles.suggestionCard} onPress={() => setInput('Explain a Quranic verse')}>\n                <Text style={styles.suggestionTitle}>Explain Verse</Text>\n                <Text style={styles.suggestionDesc}>Get detailed explanations</Text>\n              </Pressable>\n              <Pressable style={styles.suggestionCard} onPress={() => setInput('Find a specific hadith')}>\n                <Text style={styles.suggestionTitle}>Find Hadith</Text>\n                <Text style={styles.suggestionDesc}>Search prophetic traditions</Text>\n              </Pressable>\n            </View>\n          </View>\n        )}\n        \n        {messages.map((message) => {\n          const content = message.parts?.map(part => part.type === 'text' ? part.text : '').join('') || '';\n          const isThinking = (message as any).isThinking;\n          \n          return (\n            <View\n              key={message.id}\n              style={[\n                styles.messageBubble,\n                message.role === 'user' ? styles.userBubble : styles.assistantBubble,\n              ]}\n            >\n              {message.role === 'assistant' && isThinking ? (\n                <View style={styles.thinkingContainer}>\n                  <Text style={styles.thinkingText}>Done. Searching for </Text>\n                  <Text style={styles.thinkingQuery}>answers</Text>\n                  <View style={styles.thinkingDots}>\n                    <View style={[styles.dot, styles.dot1]} />\n                    <View style={[styles.dot, styles.dot2]} />\n                    <View style={[styles.dot, styles.dot3]} />\n                  </View>\n                </View>\n              ) : message.role === 'assistant' ? (\n                <Markdown\n                  style={{\n                    body: styles.messageText,\n                    code_inline: styles.inlineCode,\n                    code_block: styles.codeBlock,\n                  }}\n                >\n                  {content}\n                </Markdown>\n              ) : (\n                <Text style={styles.userMessageText} selectable>\n                  {content}\n                </Text>\n              )}\n              {!isThinking && (\n                <View style={styles.messageFooter}>\n                  <Text style={[styles.timestampText, message.role === 'user' && styles.userTimestampText]}>\n                    {new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}\n                  </Text>\n                  {message.role === 'assistant' && (\n                    <Pressable \n                      style={styles.copyButton}\n                      onPress={async () => {\n                        await Clipboard.setStringAsync(content);\n                        Alert.alert('Copied', 'Message copied to clipboard');\n                      }}\n                    >\n                      <Text style={styles.copyButtonText}>Copy</Text>\n                    </Pressable>\n                  )}\n                </View>\n              )}\n            </View>\n          );\n        })}\n      </ScrollView>\n\n      {/* Input Area */}\n      <View style={styles.inputContainer}>\n        <View style={styles.inputWrapper}>\n          <TextInput\n            style={styles.textInput}\n            value={input}\n            onChangeText={setInput}\n            placeholder=\"Ask anything\"\n            placeholderTextColor={theme.secondary}\n            multiline\n            maxLength={1000}\n            onKeyPress={(e) => {\n              if (Platform.OS === 'web' && e.nativeEvent.key === 'Enter') {\n                e.preventDefault();\n                handleSend();\n              }\n            }}\n          />\n          <Pressable\n            style={[styles.sendButton, !input.trim() && styles.sendButtonDisabled]}\n            onPress={handleSend}\n            disabled={!input.trim() || isLoading}\n          >\n            <Text style={styles.sendIcon}>↑</Text>\n          </Pressable>\n        </View>\n        <Text style={styles.disclaimerText}>AI can make mistakes. Check important info.</Text>\n      </View>\n    </SafeAreaView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.background,\n  },\n  header: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    paddingHorizontal: 16,\n    paddingVertical: 12,\n    backgroundColor: theme.background,\n    borderBottomWidth: 1,\n    borderBottomColor: theme.border,\n  },\n  menuButton: {\n    width: 40,\n    height: 40,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  menuIcon: {\n    fontSize: 20,\n    color: theme.primary,\n  },\n  appTitle: {\n    fontSize: 18,\n    fontWeight: '600',\n    color: theme.primary,\n  },\n  moreButton: {\n    width: 40,\n    height: 40,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  moreIcon: {\n    fontSize: 20,\n    color: theme.primary,\n  },\n  messagesContainer: {\n    flex: 1,\n    padding: 16,\n  },\n  welcomeContainer: {\n    flex: 1,\n    justifyContent: 'space-between',\n    paddingVertical: 40,\n  },\n  welcomeContent: {\n    alignItems: 'center',\n    flex: 1,\n    justifyContent: 'center',\n  },\n  logoContainer: {\n    marginBottom: 20,\n    alignItems: 'center',\n  },\n  logoImage: {\n    width: 100,\n    height: 100,\n  },\n  welcomeTitle: {\n    color: theme.primary,\n    fontSize: 28,\n    fontWeight: 'bold',\n    textAlign: 'center',\n    marginBottom: 8,\n  },\n  welcomeSubtitle: {\n    color: theme.secondary,\n    fontSize: 16,\n    textAlign: 'center',\n    marginBottom: 32,\n  },\n  bottomSuggestions: {\n    paddingBottom: 20,\n  },\n  suggestionCard: {\n    backgroundColor: theme.surface,\n    padding: 16,\n    marginBottom: 12,\n    borderRadius: 12,\n    borderWidth: 1,\n    borderColor: theme.border,\n  },\n  suggestionTitle: {\n    color: theme.primary,\n    fontSize: 16,\n    fontWeight: '600',\n    marginBottom: 4,\n  },\n  suggestionDesc: {\n    color: theme.secondary,\n    fontSize: 14,\n  },\n  messageBubble: {\n    marginVertical: 6,\n    padding: 14,\n    borderRadius: 16,\n    maxWidth: '85%',\n    shadowColor: theme.border,\n    shadowOffset: { width: 0, height: 1 },\n    shadowOpacity: 0.1,\n    shadowRadius: 2,\n    elevation: 1,\n  },\n  userBubble: {\n    alignSelf: 'flex-end',\n    backgroundColor: theme.accent,\n    borderBottomRightRadius: 4,\n  },\n  assistantBubble: {\n    alignSelf: 'flex-start',\n    backgroundColor: theme.surface,\n    borderWidth: 1,\n    borderColor: theme.border,\n    borderBottomLeftRadius: 4,\n  },\n  messageText: {\n    color: theme.primary,\n    fontSize: 15,\n    lineHeight: 22,\n    marginBottom: 4,\n  },\n  userMessageText: {\n    color: theme.primary,\n    fontSize: 15,\n    lineHeight: 22,\n    marginBottom: 4,\n  },\n  timestampText: {\n    color: theme.secondary,\n    fontSize: 11,\n    opacity: 0.7,\n    alignSelf: 'flex-end',\n  },\n  userTimestampText: {\n    color: theme.primary,\n    opacity: 0.8,\n  },\n  typingIndicator: {\n    alignSelf: 'flex-start',\n    backgroundColor: theme.surface,\n    padding: 12,\n    borderRadius: 16,\n    marginVertical: 4,\n    borderWidth: 1,\n    borderColor: theme.border,\n  },\n  typingText: {\n    color: theme.secondary,\n    fontSize: 14,\n    fontStyle: 'italic',\n  },\n  inputContainer: {\n    padding: 20,\n    backgroundColor: theme.background,\n  },\n  inputWrapper: {\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    backgroundColor: theme.surface,\n    borderWidth: 1,\n    borderColor: theme.border,\n    borderRadius: 24,\n    paddingHorizontal: 16,\n    paddingVertical: 12,\n    marginBottom: 8,\n    gap: 12,\n  },\n  textInput: {\n    flex: 1,\n    color: theme.primary,\n    fontSize: 16,\n    minHeight: 20,\n    maxHeight: 100,\n    paddingVertical: 0,\n    textAlignVertical: 'center',\n  },\n  sendButton: {\n    backgroundColor: theme.accent,\n    width: 32,\n    height: 32,\n    borderRadius: 16,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  sendButtonDisabled: {\n    backgroundColor: theme.secondary,\n    opacity: 0.5,\n  },\n  sendIcon: {\n    color: '#FFFFFF',\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n  disclaimerText: {\n    color: theme.secondary,\n    fontSize: 12,\n    textAlign: 'center',\n    opacity: 0.7,\n  },\n  messageFooter: {\n    flexDirection: 'row',\n    justifyContent: 'space-between',\n    alignItems: 'center',\n    marginTop: 4,\n  },\n  copyButton: {\n    paddingHorizontal: 8,\n    paddingVertical: 4,\n    borderRadius: 4,\n    backgroundColor: theme.surface,\n  },\n  copyButtonText: {\n    color: theme.secondary,\n    fontSize: 10,\n    fontWeight: '500',\n  },\n  thinkingContainer: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    padding: 8,\n  },\n  thinkingText: {\n    color: theme.secondary,\n    fontSize: 14,\n    fontStyle: 'italic',\n  },\n  thinkingQuery: {\n    color: theme.accent,\n    fontSize: 14,\n    fontStyle: 'italic',\n    fontWeight: '500',\n  },\n  thinkingDots: {\n    flexDirection: 'row',\n    marginLeft: 8,\n    alignItems: 'center',\n  },\n  dot: {\n    width: 4,\n    height: 4,\n    borderRadius: 2,\n    backgroundColor: theme.accent,\n    marginHorizontal: 1,\n  },\n  dot1: {\n    opacity: 0.7,\n  },\n  dot2: {\n    opacity: 0.5,\n  },\n  dot3: {\n    opacity: 0.3,\n  },\n  inlineCode: {\n    backgroundColor: theme.surface,\n    color: theme.primary,\n    fontSize: 14,\n    fontFamily: Platform.OS === 'ios' ? 'Menlo' : 'monospace',\n    paddingHorizontal: 4,\n    paddingVertical: 2,\n    borderRadius: 4,\n  },\n  codeBlock: {\n    backgroundColor: theme.surface,\n    color: theme.primary,\n    fontSize: 14,\n    fontFamily: Platform.OS === 'ios' ? 'Menlo' : 'monospace',\n    padding: 12,\n    borderRadius: 8,\n    borderWidth: 1,\n    borderColor: theme.border,\n  },\n});","size_bytes":12463},"src/components/ChatLayout.tsx":{"content":"import React, { useState, useEffect } from 'react';\nimport { View, Text, TextInput, Pressable, StyleSheet, ScrollView, Platform } from 'react-native';\nimport { theme } from '../theme/colors';\nimport { useConversationStore } from '../store/conversationStore';\nimport { useRouter } from 'expo-router';\n\ninterface ChatLayoutProps {\n  children: React.ReactNode;\n  conversationId?: string;\n}\n\nexport const ChatLayout: React.FC<ChatLayoutProps> = ({ children, conversationId }) => {\n  const router = useRouter();\n  const { conversations } = useConversationStore();\n  const [searchQuery, setSearchQuery] = useState('');\n  const searchInputRef = React.useRef<TextInput>(null);\n\n  useEffect(() => {\n    const handleKeyPress = (event: KeyboardEvent) => {\n      if ((event.metaKey || event.ctrlKey) && event.key === 'k') {\n        event.preventDefault();\n        searchInputRef.current?.focus();\n      }\n    };\n\n    if (Platform.OS === 'web') {\n      document.addEventListener('keydown', handleKeyPress);\n      return () => document.removeEventListener('keydown', handleKeyPress);\n    }\n  }, []);\n\n  const handleNewChat = () => {\n    const newConversationId = Date.now().toString();\n    router.push(`/chat?conversationId=${newConversationId}`);\n  };\n\n  const handleOpenChat = (id: string) => {\n    router.push(`/chat?conversationId=${id}`);\n  };\n\n  // Group conversations by date\n  const groupedConversations = conversations.reduce((groups: any, conversation) => {\n    const date = new Date(conversation.lastUpdated);\n    const dateKey = date.toLocaleDateString('en-US', { \n      weekday: 'long', \n      year: 'numeric', \n      month: 'long', \n      day: 'numeric' \n    });\n    \n    if (!groups[dateKey]) {\n      groups[dateKey] = [];\n    }\n    groups[dateKey].push(conversation);\n    return groups;\n  }, {});\n\n  return (\n    <View style={styles.container}>\n      {/* Top Search Bar */}\n      <View style={styles.topBar}>\n        <View style={styles.leftSection}>\n          <Text style={styles.logo}>Usul</Text>\n        </View>\n        \n        <View style={styles.searchContainer}>\n          <TextInput\n            ref={searchInputRef}\n            style={styles.searchInput}\n            value={searchQuery}\n            onChangeText={setSearchQuery}\n            placeholder=\"Search for a text... (⌘ + K)\"\n            placeholderTextColor={theme.secondary}\n          />\n          <Pressable style={styles.advancedSearchButton}>\n            <Text style={styles.advancedSearchText}>Advanced Search</Text>\n          </Pressable>\n        </View>\n\n        <View style={styles.rightSection}>\n          <Pressable style={styles.topBarButton}>\n            <Text style={styles.topBarButtonText}>English</Text>\n          </Pressable>\n          <Pressable style={styles.topBarButton}>\n            <Text style={styles.topBarButtonText}>●</Text>\n          </Pressable>\n          <Pressable style={styles.topBarButton}>\n            <Text style={styles.topBarButtonText}>⚙</Text>\n          </Pressable>\n        </View>\n      </View>\n\n      <View style={styles.mainContent}>\n        {/* Sidebar */}\n        <View style={styles.sidebar}>\n          {/* Chat History Header */}\n          <View style={styles.sidebarHeader}>\n            <Text style={styles.sidebarTitle}>Chat History</Text>\n            <Pressable style={styles.sidebarIcon}>\n              <Text style={styles.sidebarIconText}>⋮</Text>\n            </Pressable>\n          </View>\n\n          {/* New Chat Button */}\n          <Pressable style={styles.newChatButton} onPress={handleNewChat}>\n            <Text style={styles.newChatIcon}>+</Text>\n            <Text style={styles.newChatText}>New Chat</Text>\n          </Pressable>\n\n          {/* Chats Section */}\n          <View style={styles.chatsHeader}>\n            <Text style={styles.chatsTitle}>Chats</Text>\n            <View style={styles.chatsIcons}>\n              <Pressable style={styles.chatIcon}>\n                <Text style={styles.chatIconText}>🔍</Text>\n              </Pressable>\n              <Pressable style={styles.chatIcon}>\n                <Text style={styles.chatIconText}>⚙️</Text>\n              </Pressable>\n            </View>\n          </View>\n\n          {/* Conversation List */}\n          <ScrollView style={styles.conversationList} showsVerticalScrollIndicator={false}>\n            {Object.entries(groupedConversations).map(([date, convos]: [string, any]) => (\n              <View key={date} style={styles.dateGroup}>\n                <Text style={styles.dateHeader}>{date}</Text>\n                {convos.map((conversation: any) => (\n                  <Pressable\n                    key={conversation.id}\n                    style={[\n                      styles.conversationItem,\n                      conversationId === conversation.id && styles.conversationItemActive\n                    ]}\n                    onPress={() => handleOpenChat(conversation.id)}\n                  >\n                    <Text style={styles.conversationTitle} numberOfLines={1}>\n                      {conversation.title}\n                    </Text>\n                  </Pressable>\n                ))}\n              </View>\n            ))}\n          </ScrollView>\n        </View>\n\n        {/* Main Chat Area */}\n        <View style={styles.chatArea}>\n          {children}\n        </View>\n      </View>\n    </View>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.background,\n  },\n  topBar: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    paddingHorizontal: 20,\n    paddingVertical: 12,\n    backgroundColor: theme.accent,\n    borderBottomWidth: 1,\n    borderBottomColor: theme.border,\n  },\n  leftSection: {\n    minWidth: 100,\n  },\n  logo: {\n    color: theme.primary,\n    fontSize: 20,\n    fontWeight: 'bold',\n  },\n  searchContainer: {\n    flex: 1,\n    flexDirection: 'row',\n    alignItems: 'center',\n    backgroundColor: theme.surface,\n    borderRadius: 8,\n    marginHorizontal: 20,\n    paddingHorizontal: 16,\n    paddingVertical: 8,\n  },\n  searchInput: {\n    flex: 1,\n    color: theme.primary,\n    fontSize: 14,\n    paddingVertical: 4,\n  },\n  advancedSearchButton: {\n    paddingHorizontal: 12,\n    paddingVertical: 4,\n    borderLeftWidth: 1,\n    borderLeftColor: theme.surface,\n    marginLeft: 12,\n  },\n  advancedSearchText: {\n    color: theme.primary,\n    fontSize: 12,\n    fontWeight: '500',\n  },\n  rightSection: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 16,\n  },\n  topBarButton: {\n    paddingHorizontal: 8,\n    paddingVertical: 4,\n  },\n  topBarButtonText: {\n    color: theme.primary,\n    fontSize: 14,\n    fontWeight: '500',\n  },\n  mainContent: {\n    flex: 1,\n    flexDirection: 'row',\n  },\n  sidebar: {\n    width: 280,\n    backgroundColor: theme.surface,\n    borderRightWidth: 1,\n    borderRightColor: theme.border,\n    padding: 16,\n  },\n  sidebarHeader: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: 20,\n  },\n  sidebarTitle: {\n    color: theme.primary,\n    fontSize: 16,\n    fontWeight: '600',\n  },\n  sidebarIcon: {\n    padding: 4,\n  },\n  sidebarIconText: {\n    fontSize: 16,\n    color: theme.primary,\n  },\n  newChatButton: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    backgroundColor: theme.accent,\n    borderRadius: 8,\n    paddingHorizontal: 12,\n    paddingVertical: 10,\n    marginBottom: 24,\n    gap: 8,\n  },\n  newChatIcon: {\n    fontSize: 14,\n    color: theme.primary,\n  },\n  newChatText: {\n    color: theme.primary,\n    fontSize: 14,\n    fontWeight: '500',\n  },\n  chatsHeader: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    marginBottom: 16,\n  },\n  chatsTitle: {\n    color: theme.primary,\n    fontSize: 14,\n    fontWeight: '600',\n  },\n  chatsIcons: {\n    flexDirection: 'row',\n    gap: 8,\n  },\n  chatIcon: {\n    padding: 4,\n  },\n  chatIconText: {\n    fontSize: 12,\n    color: theme.primary,\n  },\n  conversationList: {\n    flex: 1,\n  },\n  dateGroup: {\n    marginBottom: 20,\n  },\n  dateHeader: {\n    color: theme.primary,\n    fontSize: 12,\n    fontWeight: '500',\n    marginBottom: 8,\n    textTransform: 'uppercase',\n  },\n  conversationItem: {\n    paddingVertical: 8,\n    paddingHorizontal: 12,\n    borderRadius: 6,\n    marginBottom: 4,\n  },\n  conversationItemActive: {\n    backgroundColor: theme.accent,\n  },\n  conversationTitle: {\n    color: theme.primary,\n    fontSize: 13,\n    lineHeight: 18,\n  },\n  chatArea: {\n    flex: 1,\n    backgroundColor: theme.background,\n  },\n});","size_bytes":8492},"src/components/MobileChatLayout.tsx":{"content":"import React, { useState } from 'react';\nimport { View, Text, Pressable, StyleSheet, SafeAreaView, StatusBar } from 'react-native';\nimport { theme } from '../theme/colors';\n\ninterface MobileChatLayoutProps {\n  children: React.ReactNode;\n}\n\nexport const MobileChatLayout: React.FC<MobileChatLayoutProps> = ({ children }) => {\n  const [showMenu, setShowMenu] = useState(false);\n\n  return (\n    <SafeAreaView style={styles.container}>\n      <StatusBar barStyle=\"light-content\" backgroundColor={theme.accent} />\n      \n      {/* Simple Header */}\n      <View style={styles.header}>\n        <Pressable \n          style={styles.menuButton}\n          onPress={() => setShowMenu(!showMenu)}\n        >\n          <Text style={styles.menuIcon}>☰</Text>\n        </Pressable>\n        \n        <Text style={styles.appTitle}>Usul AI</Text>\n        \n        <Pressable style={styles.shareButton}>\n          <Text style={styles.shareIcon}>⚪</Text>\n        </Pressable>\n      </View>\n\n      {/* Chat Content */}\n      <View style={styles.chatContent}>\n        {children}\n      </View>\n    </SafeAreaView>\n  );\n};\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    backgroundColor: theme.background,\n  },\n  header: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    paddingHorizontal: 16,\n    paddingVertical: 12,\n    backgroundColor: theme.background,\n    borderBottomWidth: 1,\n    borderBottomColor: theme.border,\n  },\n  menuButton: {\n    width: 40,\n    height: 40,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  menuIcon: {\n    fontSize: 20,\n    color: theme.primary,\n  },\n  appTitle: {\n    fontSize: 18,\n    fontWeight: '600',\n    color: theme.primary,\n  },\n  shareButton: {\n    width: 40,\n    height: 40,\n    justifyContent: 'center',\n    alignItems: 'center',\n  },\n  shareIcon: {\n    fontSize: 16,\n    color: theme.primary,\n  },\n  chatContent: {\n    flex: 1,\n  },\n});","size_bytes":1935},"src/components/MobileViewport.tsx":{"content":"import React from 'react';\nimport { View, StyleSheet, Platform } from 'react-native';\n\ninterface MobileViewportProps {\n  children: React.ReactNode;\n  deviceType?: 'iphone15' | 'iphone15pro' | 'default';\n}\n\nexport const MobileViewport: React.FC<MobileViewportProps> = ({ \n  children, \n  deviceType = 'iphone15' \n}) => {\n  // Always render children normally for native iPhone app\n  return <>{children}</>;\n};","size_bytes":406},"src/hooks/useGlobalChat.ts":{"content":"import type { Chat, StoredMessage } from \"../lib/db\";\nimport type { UIMessage } from \"ai\";\nimport { useCallback, useEffect, useRef, useState } from \"react\";\nimport { db } from \"../lib/db\";\nimport { useChat } from \"@ai-sdk/react\";\nimport { nanoid } from \"nanoid\";\n\n// Extended message type to include thinking state\nexport interface ExtendedUIMessage extends UIMessage {\n  isThinking?: boolean;\n}\n\ntype UseChatCoreProps = {\n  initialChat?: Chat;\n  initialId?: string;\n};\n\nexport type UseGlobalChatReturn = ReturnType<typeof useGlobalChat>;\n\nexport function useGlobalChat({\n  initialChat,\n  initialId,\n}: UseChatCoreProps) {\n  const [input, setInput] = useState(\"\");\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  const chatRef = useRef<Chat | null>(initialChat ?? null);\n\n  const handleFinish = useCallback(async (options: { message: UIMessage }) => {\n    if (!chatRef.current) return;\n    \n    try {\n      const existingChat = await db.chats.get(chatRef.current.id);\n      if (existingChat) {\n        // Convert UIMessage to StoredMessage format for storage\n        const storedMessage: StoredMessage = {\n          id: options.message.id,\n          role: options.message.role as 'system' | 'user' | 'assistant',\n          content: options.message.parts?.map(part => part.type === 'text' ? part.text : '').join('') || '',\n        };\n        \n        await db.chats.update(chatRef.current.id, {\n          messages: [...existingChat.messages, storedMessage],\n          updatedAt: new Date(),\n        });\n      }\n    } catch (error) {\n      console.error('Error saving message:', error);\n    }\n  }, []);\n\n  const ensureChatExists = useCallback(\n    async (input: string) => {\n      if (chatRef.current) return chatRef.current.id;\n\n      const newId = initialId ?? nanoid();\n\n      const newChat: Chat = {\n        id: newId,\n        title: input,\n        messages: [],\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n\n      chatRef.current = newChat;\n      \n      try {\n        await db.chats.add(newChat);\n      } catch (error) {\n        console.error('Error creating chat:', error);\n      }\n\n      return newId;\n    },\n    [initialId],\n  );\n\n  // Convert stored messages to UIMessages for the useChat hook\n  const convertedInitialMessages = initialChat?.messages?.map(msg => ({\n    id: msg.id,\n    role: msg.role,\n    parts: [{ type: 'text' as const, text: msg.content }]\n  })) || [];\n\n  // Direct OpenAI integration since API routes don't work on Expo Router web\n  const [messages, setMessages] = useState<ExtendedUIMessage[]>(convertedInitialMessages);\n  const [status, setStatus] = useState<'ready' | 'streaming'>('ready');\n  const [error, setError] = useState<any>(null);\n\n  const sendMessage = useCallback(async ({ text }: { text: string }) => {\n    try {\n      setStatus('streaming');\n      setError(null);\n\n      // Add user message immediately\n      const userMessage = {\n        id: nanoid(),\n        role: 'user' as const,\n        parts: [{ type: 'text' as const, text }]\n      };\n      \n      setMessages(prev => [...prev, userMessage]);\n      \n      // Add a temporary thinking indicator message\n      const thinkingMessage: ExtendedUIMessage = {\n        id: 'thinking-' + nanoid(),\n        role: 'assistant' as const,\n        parts: [{ \n          type: 'text' as const, \n          text: '...' \n        }],\n        isThinking: true\n      };\n      \n      setMessages(prev => [...prev, thinkingMessage]);\n\n      // Import the real LLM service from the original Usul codebase\n      const { createChatCompletion, SYSTEM_MESSAGE } = await import('../services/llm');\n      \n      let aiResponse: string;\n      \n      try {\n        aiResponse = await createChatCompletion({\n          messages: [\n            SYSTEM_MESSAGE,\n            { role: 'user', content: text }\n          ]\n        });\n      } catch (apiError) {\n        console.error('OpenAI API error:', apiError);\n        \n        // Provide a scholarly fallback response in the style of usul.ai\n        if (text.toLowerCase().includes('hadith')) {\n          aiResponse = `A hadith is defined as what has been transmitted from the Prophet Muhammad ﷺ in terms of his sayings, actions, approvals (tacit consent), or descriptions—whether physical or moral. This includes what occurred both before and after his prophethood. The hadith serves as the second primary source of Islamic law and guidance after the Qur'an, providing details and clarifications for many aspects of Islamic practice and belief.\n\nIn the terminology of hadith scholars, it is described as: \"What is attributed to the Prophet ﷺ in terms of statement, action, approval, or description.\" Some definitions also extend the term to include reports from the companions and followers, but the primary and most common usage refers to the Prophet himself.\n\nThe importance of hadith lies in its role as a source of legislation, explanation, and practical example for Muslims, as the Qur'an commands: {And whatever the Messenger has given you—take; and what he has forbidden you—refrain from}. The hadith clarifies, specifies, and details the general guidance found in the Qur'an.\n\nIn summary, a hadith is a report about the Prophet Muhammad ﷺ's words, deeds, approvals, or characteristics, and it is a foundational element of Islamic tradition and law.`;\n        } else {\n          aiResponse = `I apologize, but I'm currently experiencing connectivity issues with the AI service. This appears to be a temporary technical issue. \n\nAs Usul AI, I specialize in Islamic research and scholarship, helping users explore and understand Islamic texts, history, jurisprudence, theology, and related topics with accuracy and respect.\n\nPlease try your question again, and I'll do my best to provide you with accurate, well-sourced information while maintaining a respectful and scholarly tone.\n\nIf the issue persists, please ensure your internet connection is stable or contact support.`;\n        }\n      }\n      \n      const aiMessage = {\n        id: nanoid(),\n        role: 'assistant' as const,\n        parts: [{ \n          type: 'text' as const, \n          text: aiResponse\n        }]\n      };\n      \n      // Replace the thinking message with the actual response\n      setMessages(prev => {\n        const filtered = prev.filter(msg => !msg.isThinking);\n        return [...filtered, aiMessage];\n      });\n      setStatus('ready');\n\n      // Call onFinish for persistence\n      handleFinish({ message: aiMessage });\n\n    } catch (err) {\n      console.error('Error sending message:', err);\n      \n      // Remove thinking message on error\n      setMessages(prev => prev.filter(msg => !msg.isThinking));\n      \n      setError(err);\n      setStatus('ready');\n    }\n  }, [handleFinish]);\n\n  const stop = useCallback(() => {\n    setStatus('ready');\n  }, []);\n\n  const regenerate = useCallback(() => {\n    // Implement regeneration logic\n    if (messages.length > 0) {\n      const lastUserMessage = messages[messages.length - 2];\n      if (lastUserMessage?.role === 'user') {\n        // Remove last assistant message and regenerate\n        setMessages(prev => prev.slice(0, -1));\n        const text = lastUserMessage.parts?.[0]?.type === 'text' ? lastUserMessage.parts[0].text : '';\n        if (text) {\n          sendMessage({ text });\n        }\n      }\n    }\n  }, [messages, sendMessage]);\n\n  const submit = useCallback(async () => {\n    if (!input.trim() || isSubmitting || status !== 'ready') return;\n    \n    setIsSubmitting(true);\n\n    try {\n      // Ensure chat exists before sending\n      const currentChatId = await ensureChatExists(input);\n      \n      // Create and save user message\n      const userMessage: StoredMessage = {\n        id: nanoid(),\n        role: 'user',\n        content: input,\n      };\n\n      // Add user message to chat\n      if (chatRef.current) {\n        const existingChat = await db.chats.get(chatRef.current.id);\n        if (existingChat) {\n          await db.chats.update(chatRef.current.id, {\n            messages: [...existingChat.messages, userMessage],\n            updatedAt: new Date(),\n          });\n        }\n      }\n\n      // Send message via AI SDK\n      await sendMessage({\n        text: input,\n      });\n\n      setInput(\"\");\n    } catch (error) {\n      console.error('Error submitting message:', error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  }, [\n    input,\n    isSubmitting,\n    status,\n    ensureChatExists,\n    sendMessage,\n  ]);\n\n  const append = useCallback(\n    (text: string) => {\n      setInput(text);\n      // Auto-submit when appending\n      setTimeout(() => {\n        if (status === 'ready') {\n          submit();\n        }\n      }, 100);\n    },\n    [status, submit],\n  );\n\n  return {\n    messages,\n    setMessages,\n    input,\n    setInput,\n    submit,\n    append,\n    status,\n    stop,\n    reload: regenerate,\n    isSubmitting,\n    error,\n  };\n}","size_bytes":8876},"src/lib/db.ts":{"content":"import { Platform } from 'react-native';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\n// Custom message interface for storage\nexport interface StoredMessage {\n  id: string;\n  role: 'system' | 'user' | 'assistant';\n  content: string;\n}\n\n// Chat interface based on Usul's implementation\nexport interface Chat {\n  id: string;\n  title: string;\n  messages: StoredMessage[];\n  createdAt: Date;\n  updatedAt: Date;\n}\n\n// Web-only Dexie database (lazy loaded)\nlet webDB: any = null;\n\n// Initialize database based on platform\nexport async function initializeDatabase() {\n  try {\n    if (Platform.OS === 'web') {\n      // Dynamically import Dexie only on web\n      const Dexie = (await import('dexie')).default;\n      \n      class UsulChatDatabase extends Dexie {\n        chats!: any;\n\n        constructor() {\n          super('UsulChatDB');\n          this.version(1).stores({\n            chats: 'id, title, createdAt, updatedAt'\n          });\n        }\n      }\n      \n      webDB = new UsulChatDatabase();\n      await webDB.open();\n      console.log('Web database initialized successfully');\n    } else {\n      // Use AsyncStorage for React Native\n      console.log('Using AsyncStorage for React Native');\n    }\n  } catch (error) {\n    console.error('Failed to initialize database:', error);\n  }\n}\n\n// Auto-initialize database on web\nif (typeof window !== 'undefined') {\n  initializeDatabase();\n}\n\n// Database operations abstraction\nexport const db = {\n  chats: {\n    async get(id: string): Promise<Chat | undefined> {\n      if (Platform.OS === 'web' && webDB) {\n        return await webDB.chats.get(id);\n      } else {\n        const stored = await AsyncStorage.getItem(`chat_${id}`);\n        return stored ? JSON.parse(stored) : undefined;\n      }\n    },\n\n    async add(chat: Chat): Promise<void> {\n      if (Platform.OS === 'web' && webDB) {\n        await webDB.chats.add(chat);\n      } else {\n        await AsyncStorage.setItem(`chat_${chat.id}`, JSON.stringify(chat));\n      }\n    },\n\n    async update(id: string, changes: Partial<Chat>): Promise<void> {\n      if (Platform.OS === 'web' && webDB) {\n        await webDB.chats.update(id, changes);\n      } else {\n        const existing = await this.get(id);\n        if (existing) {\n          const updated = { ...existing, ...changes };\n          await AsyncStorage.setItem(`chat_${id}`, JSON.stringify(updated));\n        }\n      }\n    }\n  }\n};","size_bytes":2411},"start_app.sh":{"content":"#!/bin/bash\n\n# Usul AI - Local Development Startup Script\n# This script sets up and runs your React Native/Expo app on macOS\n\necho \"🚀 Starting Usul AI Chat App...\"\necho \"\"\n\n# Check if Node.js is installed\nif ! command -v node &> /dev/null; then\n    echo \"❌ Node.js not found. Please install Node.js from https://nodejs.org/\"\n    exit 1\nfi\n\n# Check if npm is installed\nif ! command -v npm &> /dev/null; then\n    echo \"❌ npm not found. Please install Node.js which includes npm.\"\n    exit 1\nfi\n\n# Check if Expo CLI is installed globally\nif ! command -v expo &> /dev/null; then\n    echo \"📦 Installing Expo CLI globally...\"\n    npm install -g @expo/cli\nfi\n\n# Install dependencies if node_modules doesn't exist\nif [ ! -d \"node_modules\" ]; then\n    echo \"📦 Installing project dependencies...\"\n    npm install\nfi\n\n# Set OpenAI API Key environment variable\nif [ -z \"$OPENAI_API_KEY\" ]; then\n    echo \"\"\n    echo \"⚠️  OpenAI API Key not found in environment variables.\"\n    echo \"Please set your OpenAI API key:\"\n    read -p \"Enter your OpenAI API Key: \" api_key\n    export OPENAI_API_KEY=\"$api_key\"\n    echo \"\"\n    echo \"✅ API Key set for this session.\"\n    echo \"To make it permanent, add this to your ~/.bash_profile or ~/.zshrc:\"\n    echo \"export OPENAI_API_KEY=\\\"$api_key\\\"\"\n    echo \"\"\nfi\n\necho \"🎯 Starting Expo development server...\"\necho \"\"\necho \"📱 Your app will be available at:\"\necho \"   - Web: http://localhost:5000\"\necho \"   - iOS Simulator: Use the QR code with Camera app\"\necho \"   - Android: Use the QR code with Expo Go app\"\necho \"\"\necho \"⌨️  Useful commands:\"\necho \"   - Press 'w' to open in web browser\"\necho \"   - Press 'i' to open iOS simulator\"\necho \"   - Press 'a' to open Android emulator\"\necho \"   - Press 'r' to reload the app\"\necho \"   - Press 'q' to quit\"\necho \"\"\n\n# Start the Expo development server\nEXPO_DEVTOOLS_LISTEN_ADDRESS=0.0.0.0 npx expo start --port 5000","size_bytes":1911}},"version":1}